This is Blueprint is provided as a helper for people using the Octoprint Plugin called OctoPrint-HomeAssistant. What this does is add 6 buttons, 4 of which you as the user can set your own G-Codes to for customizing. Also adds safe shutdown and presentation functions.

## üìë Changelog

* **2023-03-19**: üéâ First release!
<base target="_blank">

## üîÆ About this blueprint

Type of blueprint: AUTOMATION

Why do I need this?

> This is Blueprint is provided as a helper for people using the Octoprint Plugin called [OctoPrint-HomeAssistant](https://github.com/cmroche/OctoPrint-HomeAssistant).  Within that Plugin there are several suggested Home Assistant Lovelace/Dashboard based functions, and this will build them all for you.
>
> This gives you those optional features suggested in this plug-in's README plus gives you Home Assistant buttons you can call from scripts and automations to activate them.
>
>
> NOTE!!!  WARNING!!! The first thing to remember is ANYTIME you make ANY changes to this Blueprint, you MUST restart the server so that the button entities can rebuild in the configuration you have selected. If you don't restart OctoPrint, the change may not be seen and you will wonder why and what is happening.
>
>

## üîß Configuration

Requirements

* The [OctoPrint-MQTT](https://plugins.octoprint.org/plugins/mqtt/) plug-in installed.
* The [OctoPrint-HomeAssistant](https://github.com/cmroche/OctoPrint-HomeAssistant) plugin installed.
* You will also need to be connected to an MQTT Broker that your Home Assistant instance is also connected to. Set-up for all that is covered within those packages.
* Mains power to the printer, Pi, and associated equipment connectd thru one or more Home Assistant controllable smart switches.

## üóÇ Input fields

    base_topic/name: MQTT Topic for the printer
        This needs to be the base topic that you added into the Octoprint
        MQTT Plug-in.

    device_id/name: Value of the Home Assistant Discovery node id
        This needs to be the Discovery settings - Node ID
        that you added into the Octoprint Homeassistant Discovery Plug-in.

    device_name/name: Name of the Home Assistant Discovery Device
        This needs to be the Device settings - Device name
        that you added into the Octoprint Homeassistant Discovery Plug-in.

    print_status/name: print status sensor
        Sensor that looks like this: 
        sensor.[Home Assistant Discovery Device]_print_status
        This was generated by Octoprint Homeassistant Discovery plugin.

    print_state/name: print status sensor
        Sensor that looks like this:
        binary_sensor.[Home Assistant Discovery Device]_printing
        This was generated by Octoprint Homeassistant Discovery plugin.

    printhead_temp/name: printhead temperature sensor
        Sensor that looks like this:
        sensor.[Home Assistant Discovery Device]_tool_0_temperature
        This was generated by Octoprint Homeassistant Discovery plugin.

    octoprint_shutdown/name: octoprint shutdown button
        Button that looks like this:
        button.[Home Assistant Discovery Device]_shutdown_system
        This was generated by Octoprint Homeassistant Discovery plugin.

    printer_power_switch/name: Mains switch that controls the printer and/or pi mains power
        This needs to be the Home Assistant name of the switch that
        turns off the power to the printer.
        Multiples are allowed here.

    asd_u_trig_temp/name: Auto Shutdown Upper Trigger
        Set this to the temperature that you want the extruder
        to be at when the auto-shutdown sequence begins.

    asd_l_trig_temp/name: Auto Shutdown Lower Trigger
        Set this to the temperature that you want the extruder
        to be at when the auto-shutdown sequence no longer applies.

    asd_delay/name: Auto Shutdown Delay
        This is the timer that starts as soon as the Extruder temperature
        is in the range between the Upper Trigger and the Lower Trigger.

    home_button: 
      name: Custom command for Home Button
        This is the Marlin Home Command, change as you see fit.

    bed_level_button/name: Custom GCode command for the Bed Level Button
        This is the Marlin Bed Level Command, change as you see fit

    aux_1/name: Custom GCode command for Aux Button 1
        Use this to send a custom GCode command to the printer.

    aux_2/name: Custom GCode command for Aux Button 2
        Use this to send a custom GCode command to the printer.

## üé§ ‚úàÔ∏è Extended Information

For further information, reference these links.

> [Octoprint api commands for printer operation](https://docs.octoprint.org/en/master/api/printer.html#sec-api-printer-printheadcommand)
> 
> [Octoprint Homeassistant Discovery Plugin Sending commands to the printer](https://github.com/cmroche/OctoPrint-HomeAssistant#sending-commands-to-the-printer)

## üëÄ How do I find the info for the first 3 inputs?

The information for these is located in your OctoPrint Dashboard.  The assumption is that you have the 2 required plugins installed and OctoPrint-Homeassistant is set-up and working first.

Start by opening your OctoPrint Dashboard.  Click the wrench and find the MQTT Plugin.

![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintWrench.png?raw=true "Find OctoPrint Wrench")
![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintMQTTMenu.png?raw=true "Find OctoPrint Wrench")

Once here, click the Topics Tab.
Copy exactly the text located in the ```Base topic``` box.  All capitalization, punctuation, & spaces are required to match up the Blueprint buttons with the original installation. Plug that into the first input for MQTT Topic.
![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintBaseTopic.png?raw=true "Find OctoPrint Wrench")

Next select the HomeAssistant Discovery tab on the left
![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintHAMenu.png?raw=true "Find OctoPrint Wrench")

Copy all the text in the Node ID box and plug that into the second input for the Device_ID / Node ID Input in the Blueprint.
![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintNodeID.png?raw=true "Find OctoPrint Wrench")

Finally locate the Device name in the same tab. Copy that for the third input device name.
![Find OctoPrint Wrench](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintDeviceName.png?raw=true "Find OctoPrint Wrench")

## ü™Ñ How do I turn off the Auto-Shutdown Thing?

The BluePrint creates a data select entity which gives you the ability to enable or disable the Auto-Shutdown Feature.  On first run, the state of this entity will be 'unknown' and will likely disable the feature. I highly suggest you head over to Devices and select either enabled or disabled to make it more certain what the state is. [![Open your Home Assistant instance and show your devices.](https://my.home-assistant.io/badges/devices.svg)](https://my.home-assistant.io/redirect/devices/)

![Find the BluePrint Device page](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintAutoEnable1.png?raw=true "Find the BluePrint Device page")

Once you open the Device page, go to the entity znd select one of the 2 options.  If you change your mind at any time, you can change this.  It can even be an automated change as the entity is available.

![Click the arrow](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintAutoEnable2.png?raw=true "Click the arrow") ![Select the Mode](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintAutoEnable3.png?raw=true "Select the Mode")

## ‚õàüö®üõü Why do the changes I make to the buttons never show up at all???

Yes, I know I'm putting the same information in here twice, but that is because I know I'm going to get service calls about this but trust me, there is nothing I can do...
**NOTE!!!  WARNING!!!** The first thing to remember is *ANYTIME* you make *ANY* changes to this Blueprint, you *MUST* restart the server so that the button entities can rebuild with the configuration you have selected. If you don't restart OctoPrint, the change may not be seen and you will wonder why and what is happening.

## üé∞ What Can My Dashboard Look Like?

Here is a copy of my Dashboard (Lovelace) that you can use as you like or be inspired by.  It's a bit busy for some people, but I LIKE busy dashboards. It lives in my home and [on GitHub](https://github.com/SirGoodenough/Home-Assistant-Config/blob/master/.storage/lovelace) if you need more information.
[My Sample Dashboard YAML code](https://github.com/SirGoodenough/HA_Blueprints/blob/master/Samples/Octoprint_Homeassistant_Dashboard_Lovelace.yaml)

![Main Dashboard Image](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintDashboardMain.png?raw=true "Main Dashboard Image")

![Secondary Dashboard Image](https://github.com/SirGoodenough/HA_Blueprints/blob/master/images/OctoprintDashboardSecondary.png?raw=true "Secondary Dashboard Image")

## üåû ‚ùÑÔ∏è Troubleshooting tip

If you are troubleshooting and you want to see more traces back when doing so, here is a TIP I've found.
Manually edit the automation created with the ui editor (or manually with a text editor) and add the following to have this automation contain 10 traces instead of the normal 5. Then if the automation is triggering often, you can see the last 10 traces to help you decide what the issue is.
[HA Docs on this here.](https://www.home-assistant.io/docs/automation/troubleshooting/#traces)

```yaml
trace:
  stored_traces: 10
```

## üì© **Version Updates**

Updates will be published on my [GIT repository](https://github.com/SirGoodenough/HA_Blueprints) with the rest of my Home Assistant Blueprint collection.

üì© There is not an official version control system for Blueprints. However I have found something that comes pretty close. It is not perfect, but for **MOST** Blueprints, it does just fine. I encourage you to check this script out and use it to easily check if I have updated this blueprint. [üîókoter84 Blueprint Update Script ](https://github.com/koter84/HomeAssistant_Blueprints_Update/)

# Please Click the üß° at the end of this top Post if you find this Useful

## üì≤ **Software to Download** üíæ

HA link to download blueprint: [![Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled.](https://my.home-assistant.io/badges/blueprint_import.svg)](https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=https%3A%2F%2Fgithub.com%2FSirGoodenough%2FHA_Blueprints%2Fblob%2Fmaster%2FAutomations%2FOctoprint_Additional_Buttons_Helper.yaml)

Direct link to download Blueprint: ```https://github.com/SirGoodenough/HA_Blueprints/blob/master/Automations/Octoprint_Additional_Buttons_Helper.yaml```

https://github.com/SirGoodenough/HA_Blueprints/blob/master/Automations/Octoprint_Additional_Buttons_Helper.yaml

# üåê All My Blueprints

[Link to ALL my Blueprints](https://github.com/SirGoodenough/HA_Blueprints/blob/master/README.md)

Here is a list of each of my blueprints, a quick description and jump links to the Blueprints Exchange post...

## üåÄ Scripts

#### üßØBroadlink on Script Blueprint

https://community.home-assistant.io/t/script-blueprint-to-turn-my-tv-on-and-put-it-into-the-correct-mode-for-the-input-device-i-want/338755

This is a SCRIPT Blueprint that uses my Broadlink RM3 to turn my TV on and get it into the correct mode, Pushes remote buttons in sequence.

#### üßØTasmota EZ Button Blueprint

This Script Blueprint generates 3 Buttons to help you manage your Tasmota installed base. Restart All, Update a few, and Update all.

https://community.home-assistant.io/t/script-blueprint-that-generates-3-ez-buttons-to-manage-your-tasmota-cluster/376934

#### üßØPlay Media File Script Blueprint Blueprint

This is a SCRIPT Blueprint. This provides a way to play canned media files with the big long list of YAML entries but keep the main script or automation clean.

https://community.home-assistant.io/t/script-blueprint-to-play-media-player-files-not-an-automation-blueprint/371988

#### üßØTTS All Message Blueprint

This script can use any of the 11 integrated TTS Platforms in Home Assistant to send a message to a media player.

https://community.home-assistant.io/t/tts-script-blueprint-for-all-11-ha-core-tts-flavors/400700

## üîÉ Automations

#### üßØAuto Fan Control Blueprint

This Blueprint is for controlling a 3 speed fan based on a temperature sensor. Both fan % control & MQTT fan control versions.

https://community.home-assistant.io/t/auto-fan-temp-control-for-3-speed-fan-using-ha-fan-or-mqtt-integration/326419

#### üßØDoor Open TTS Cloud-Say Message Blueprint

This Blueprint is a TTS.cloud-say version of another Door Announcer I found in the HA Blueprint Exchange.

https://community.home-assistant.io/t/door-open-tts-cloud-say-announcer-nabu-casa-required/316046

#### üßØKeypad Lock or puzzle Box Tool Blueprint

This Blueprint accepts 5 actions & when done in the right order, flips an input_boolean.

https://community.home-assistant.io/t/keypad-cipher-code-for-5-button-presses-before-you-turn-on-an-input-boolean/322385

#### üßØZigbee2MQTT - Xiaomi Cube Controller Blueprint

This Blueprint uses a Zigbee2MQTT built sensor to sort out the multitude of commands from the Xiaomi Magic Cube Remote. 

https://community.home-assistant.io/t/zigbee2mqtt-xiaomi-cube-controller/393203

#### üßØZigbee2MQTT - ZemiSmart ZM-RM02 Controller Blueprint

This Blueprint uses the Z2M (Zigbee2MQTT) imported Action sensor to sort out the 18 commands from the ZemiSmart ZM-RM02 Controller.

https://community.home-assistant.io/t/zigbee2mqtt-zemismart-zm-rm02-controller/412650

#### üßØZHA - Xiaomi Cube Controller Blueprint

This Blueprint uses a ZHA built sensor to sort out the 38(+54) commands from the Xiaomi Magic Cube Remote. 

https://community.home-assistant.io/t/zha-xiaomi-cube-controller/495975

#### üßØDevice_tracker Monitor & Notifier

This Blueprint Monitor's device_tracker entities that you choose & notifies you if they go offline. Then it gives you the opportunity to devise an action to deal with it.

https://community.home-assistant.io/t/device-tracker-monitor-notifier/500688

#### üßØ Zigbee2MQTT Aqara Magic Cube T1-Pro CTP-R01 Xiaomi Lumi cagl02

This Blueprint gives you literally hundreds of actions available on the new Magic Cube.

https://community.home-assistant.io/t/zigbee2mqtt-aqara-magic-cube-t1-pro-ctp-r01-xiaomi-lumi-cagl02/525111

#### üßØ Humidifier Water Throttle Control

This blueprint monitors a humidity sensor & by determining the error from the goal, sends info to a humidifier as to how long to flow the water. This saves water & has a minimal effect on function. Requires a Sonoff SV, Generic hygrostat Integration, & a suitable humidifier.

https://community.home-assistant.io/t/humidifier-water-throttle-control/527583

#### üßØ Person_Alert_Blueprint

BluePrint will monitor a person or persons, and when they 'enter' or 'leave' the zone or zones you pick, it will trigger an action for both enter and leave phases. Yes, it will watch multiple people and multiple zones at the same time!

https://community.home-assistant.io/t/person-alert-blueprint/542209

#### üßØ Octoprint_Additional_Buttons_Helper

This is Blueprint is provided as a helper for people using the Octoprint Plugin called OctoPrint-HomeAssistant. What this does is add 6 buttons, 4 of which you as the user can set your own G-Codes to for customizing. Also adds safe shutdown and presentation functions.

https://community.home-assistant.io/t/octoprint-additional-buttons-helper-blueprint/549826

## ü§πüèæ‚Äç‚ôÇÔ∏è Contact Links or see my other work

What are we Fixing Today Homepage / Website: https://www.WhatAreWeFixing.Today/

Channel Link URL: (WhatAreWeFixingToday) https://bit.ly/WhatAreWeFixingTodaysYT

Discord Guild: (Sir_Goodenough#9683) https://discord.gg/Uhmhu3B

## üßÄ If you want to support me

Buy me Coffee: https://www.buymeacoffee.com/SirGoodenough

PayPal one-off donation link: https://www.paypal.me/SirGoodenough

#WhatAreWeFixingToday

#SirGoodEnough